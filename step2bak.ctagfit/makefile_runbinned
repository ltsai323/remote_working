#singleMAKEFILE := makefile_3fits_btagcut_psuedodata
iYAMLcvsb := source.btag_psuedofit_cvsb.yaml
iYAMLcvsl := source.btag_psuedofit_cvsl.yaml
iYAMLbtag := source.btag_psuedofit_btag.yaml
#binningFOLDER := /afs/cern.ch/work/l/ltsai/Work/CMSSW/CMSSW_13_0_21/src/macros/step2bak.makehisto/makehisto_allgjets_binned_ctagfit

check_defined = \
    $(strip $(foreach 1,$1, \
    $(call __check_defined,$1,$(strip $(value 2)))))
__check_defined = \
    $(if $(value $1),, \
    $(error Undefined $1$(if $2, ($2))))
# 通用目標，使用 % 做 pattern matching
makebin_%:
	@bin_hist=$*; \
	echo "Running binning $$bin_hist"; \
	cc=$${bin_hist##*__}; binning_str=$${cc%.*} ; \
	make -f $(singleMAKEFILE) all \
		oDIR=binned_$$binning_str \
		iYAMLcvsb=$(iYAMLcvsb) \
		iYAMLcvsl=$(iYAMLcvsl) \
		iYAMLbtag=$(iYAMLbtag) \
		rootMAKEHISTO=$(binningFOLDER)/$$bin_hist > logs_$$binning_str; \
	mv logs_$$binning_str binned_$$binning_str

# 提供 binning 的實際清單
BINNING_FILELIST := \
	makehisto_binned_ctagfit_psuedodata__0_0_210_230.root \
	makehisto_binned_ctagfit_psuedodata__0_0_230_250.root \
	makehisto_binned_ctagfit_psuedodata__0_0_250_300.root \
	makehisto_binned_ctagfit_psuedodata__0_0_300_400.root \
	makehisto_binned_ctagfit_psuedodata__0_0_400_500.root \
	makehisto_binned_ctagfit_psuedodata__0_0_500_600.root \
	makehisto_binned_ctagfit_psuedodata__0_0_600_1000.root \
	makehisto_binned_ctagfit_psuedodata__0_0_1000_1500.root \
	makehisto_binned_ctagfit_psuedodata__0_1_210_230.root \
	makehisto_binned_ctagfit_psuedodata__0_1_230_250.root \
	makehisto_binned_ctagfit_psuedodata__0_1_250_300.root \
	makehisto_binned_ctagfit_psuedodata__0_1_300_400.root \
	makehisto_binned_ctagfit_psuedodata__0_1_400_500.root \
	makehisto_binned_ctagfit_psuedodata__0_1_500_600.root \
	makehisto_binned_ctagfit_psuedodata__0_1_600_1000.root \
	makehisto_binned_ctagfit_psuedodata__0_1_1000_1500.root \
	makehisto_binned_ctagfit_psuedodata__1_0_210_230.root \
	makehisto_binned_ctagfit_psuedodata__1_0_230_250.root \
	makehisto_binned_ctagfit_psuedodata__1_0_250_300.root \
	makehisto_binned_ctagfit_psuedodata__1_0_300_400.root \
	makehisto_binned_ctagfit_psuedodata__1_0_400_500.root \
	makehisto_binned_ctagfit_psuedodata__1_0_500_600.root \
	makehisto_binned_ctagfit_psuedodata__1_0_600_1000.root \
	makehisto_binned_ctagfit_psuedodata__1_1_210_230.root \
	makehisto_binned_ctagfit_psuedodata__1_1_230_250.root \
	makehisto_binned_ctagfit_psuedodata__1_1_250_300.root \
	makehisto_binned_ctagfit_psuedodata__1_1_300_400.root \
	makehisto_binned_ctagfit_psuedodata__1_1_400_500.root \
	makehisto_binned_ctagfit_psuedodata__1_1_500_600.root \
	makehisto_binned_ctagfit_psuedodata__1_1_600_1000.root
	
# Create output directory
$(oDIR):
	$(call check_defined,binningFOLDER)
	$(call check_defined,singleMAKEFILE)
	@echo "[INFO] Creating directory: $(oDIR)"
	mkdir $@
allbinning: $(oDIR) $(addprefix makebin_,$(BINNING_FILELIST)) ## run "make -f singleMAKEFILE all" for all histograms
	mv binned_* $(oDIR)/
IN_ARGS = \n    [singleMAKEFILE=makefile_3fits_btagcut_psuedodata] \n    [binningFOLDER=/afs/cern.ch/work/l/ltsai/Work/CMSSW/CMSSW_13_0_21/src/macros/step2bak.makehisto/makehisto_allgjets_binned_ctagfit] \n    [oDIR=result_test] \n    [iYAMLcvsb=source.btag_psuedofit_cvsb.yaml] \n    [iYAMLcvsl=source.btag_psuedofit_cvsl.yaml] \n    [iYAMLbtag=source.btag_psuedofit_btag.yaml]

help:  ## Display this help
	@awk 'BEGIN {FS = ":.*##"; printf "Usage: make \033[32m<command>\033[0m $(IN_ARGS)\n\nCommands:\n\033[36m\033[0m\n"} /^[0-9a-zA-Z_-]+:.*?##/ { printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2 } /^##@/ { printf "\n\033[1m%s\033[0m\n", substr($$0, 5) } ' $(MAKEFILE_LIST)

.DEFAULT_GOAL := help

#singleMAKEFILE:=makefile_3fits_btagcut_psuedodata
#iYAMLcvsb:=source.btag_psuedofit_cvsb.yaml
#iYAMLcvsl:=source.btag_psuedofit_cvsl.yaml
#iYAMLbtag:=source.btag_psuedofit_btag.yaml
#binningFOLDER:=/afs/cern.ch/work/l/ltsai/Work/CMSSW/CMSSW_13_0_21/src/macros/step2bak.makehisto/makehisto_allgjets_binned_ctagfit
#
#
#
#makesinglebin: ## hiiii
#	make -f $(singleMAKEFILE) all \
#		oDIR=$(outDIR) \
#		iYAMLcvsb=$(iYAMLcvsb) \
#		iYAMLcvsl=$(iYAMLcvsl) \
#		iYAMLbtag=$(iYAMLbtag) \
#		rootMAKEHISTO=$(rootFILE) | tee $(outLOG)
##mv log_full_$binningSTR $out_dir
##
##out_folder=${outTAG}_3fit_psueoddata_GJetPythia1
##mkdir $out_folder; mv binned_* $out_folder
#makebin_0_0_210_230:
#	make -f $(singleMAKEFILE) all \
#		oDIR=binned_0_0_210_230 \
#		iYAMLcvsb=$(iYAMLcvsb) \
#		iYAMLcvsl=$(iYAMLcvsl) \
#		iYAMLbtag=$(iYAMLbtag) \
#		rootMAKEHISTO=$(binningFOLDER)/makehisto_binned_ctagfit_psuedodata__0_0_210_230.root | tee logs_0_0_210_230
#	mv logs_0_0_210_230 binned_0_0_210_230
#makebin_0_1_210_230:
#	make -f $(singleMAKEFILE) all \
#		oDIR=binned_0_1_210_230 \
#		iYAMLcvsb=$(iYAMLcvsb) \
#		iYAMLcvsl=$(iYAMLcvsl) \
#		iYAMLbtag=$(iYAMLbtag) \
#		rootMAKEHISTO=$(binningFOLDER)/makehisto_binned_ctagfit_psuedodata__0_1_210_230.root | tee logs_0_1_210_230
#	mv logs_0_1_210_230 binned_0_1_210_230
#
#
#
### [binningFOLDER=/afs/cern.ch/work/l/ltsai/Work/CMSSW/CMSSW_13_0_21/src/macros/step2bak.makehisto/makehisto_allgjets_binned_ctagfit]
#allbinning: \
#		makebin_0_0_210_230 \
#		makebin_0_1_210_230
#	mkdir  testres; mv binned_* testres/ 
#
	

	
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_0_210_230.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_0_230_250.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_0_250_300.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_0_300_400.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_0_400_500.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_0_500_600.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_0_600_1000.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_0_1000_1500.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_1_210_230.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_1_230_250.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_1_250_300.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_1_300_400.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_1_400_500.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_1_500_600.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_1_600_1000.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__0_1_1000_1500.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_0_210_230.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_0_230_250.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_0_250_300.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_0_300_400.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_0_400_500.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_0_500_600.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_0_600_1000.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_1_210_230.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_1_230_250.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_1_250_300.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_1_300_400.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_1_400_500.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_1_500_600.root
#runWPcut $folder/makehisto_binned_ctagfit_psuedodata__1_1_600_1000.root

